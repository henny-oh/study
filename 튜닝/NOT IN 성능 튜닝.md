# NOT IN 조건 성능 튜닝

NOT IN 조건을 가진 쿼리을 튜닝해보자.
우선 NOT IN 조건은 인덱스를 타지 못한다. 타지 못하는 이유와 그 해결법을 알아보자.

## 부정 조건
NOT, != 와 같은 조건은 인덱스를 타지 못한다. 그 이유는 결과를 알기 위해서는 데이터 전체를 읽어야하기 때문이다. 

인덱스를 탄다는 것은 인덱스의 시작 지점과 끝나는 지점이 명확해 데이터의 읽는 범위를 줄여줄 수 있을 때를 말한다. 하지만 부정 조건은 특정 값 외 모든 값이 해당되기 때문에 모든 데이터를 읽어야 해 읽는 범위를 줄여줄 수 없다. 

따라서 쿼리에서 부정형을 만났을 경우, 쿼리 변경을 통해 구조를 바꿔 인덱스를 탈 수 있도록 변경해야 한다.

## LEFT OUTER JOIN으로 해결하기

### LEFT OUTER JOIN
왼쪽 테이블의 것은 조건에 부합하지 않더라도 모두 결합되어야 한다.
->첫번 째 테이블은 모두 출력되어야 한다.



![Alt text](/튜닝/IMAGE/1.PNG)

a,b라는 칼럼이 각각 존재하는 A,B라는 테이블을 표현한 것이다.

![Alt text](/튜닝/IMAGE/2.PNG)

그림과 같이 왼쪽(A) 테이블은 조건에 맞지 않아도 모든 값이 출력된다. 조건에 맞지 않는 오른쪽(B) 테이블의 칼럼은 NULL 값으로 표현된다.

### LEFT OUTER JOIN으로 NOT IN 표현하기
NOT IN은 조건에 해당되지 않는 칼럼만 선택하는 것이다. 
![Alt text](/튜닝/IMAGE/3.PNG)

LEFT OUTER JOIN 후 B테이블의 칼럼이 NULL인 값을 찾으면 NOT IN과 같은 결과를 얻을 수 있다. 

![Alt text](/튜닝/IMAGE/4.PNG)

### 가공된 칼럼이 사용된 NOT IN 조건 튜닝하기
아래 쿼리 같이 가공된 칼럼이 사용된 NOT IN 조건을 튜닝해보자.