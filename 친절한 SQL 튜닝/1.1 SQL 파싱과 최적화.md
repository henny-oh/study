# [친절한 SQL 튜닝 요약] 1.1  SQL 파싱과 최적화
튜닝 원리를 정확히 이해하기 전에 옵티마이저가 SQL을 처리하는 방법과 서버 프로세스의 데이터 사용/ 저장 방법을 먼저 살펴 본다.

<hr/>

## 1.1. 구조적, 집합적, 선언적 질의어

### -SQL (Structured Query Language)
구조적 질의 언어로 오라클 PL/SQL, SQL server T-SQL처럼 절차적 프로그래밍 기능 구현할 수 잇는 확장 언어도 제공한다.
원하는 결과를 구조적, 집합적으로 선언하지만 그 결과집합을 만드는 과정은 절차적이다.



### -SQL 최적화
 SQL 옵티마이저는 DBMS 내부 엔진으로 프로시저를 생성한다. 프로시저를 작성하고 컴파일해 실행 가능한 상태로 만드는 전 과정을 "SQL최적화"라고 한다.

![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/1.PNG)
 <hr/>
 
 ## 1.2 SQL 최적화

 ### (1) SQL 파싱
    사용자에게 SQL을 전달 받으면 SQL 파서가 파싱을 진행한다.
    -파싱 트리 생성 :SQL문을 이루는 구성요소 분석해 트리 생성
    -SYNTAX 확인 : 문법적 오류 (사용할 수 없는 키워드, 순서, 누락된 키워드)
    -SEMANTIC 확인 : 의미상 오류 (테이블/칼럼 존재, 권한 여부)

### (2) SQL 최적화
    옵티마이저는 미리 수집한 시스템 및 오브젝트 통계 정보를 바탕으로 다양한 실행경로를 생성해 가장 효율적인 하나늘 선택한다.
    옵티마이저는 DB 성능을 결정하는 가장 핵심 엔진이다.

### (3) 로우 소스 생성
    로우 소스 생성기는 옵티마이저가 선택한 실행 경로를 실제 실행 가능 코드 또는 프로시저 형태로 포맷팅한다.

<hr/>

## 1.3 SQL 옵티마이저
옵티마이저는 최적의 데이터 엑세스 경로를 선택해주는 DBMS 핵심엔진이다.

    -최적화 단계
    (1) 쿼리 수해을 위해 후보군이 될만한 실행계획을 모두 찾아낸다.
    (2) 데이터 딕셔너리에 수집해 놓은 통계 정보를 사용해 각 실행계획의 예상 비용을 산정한다.
    (3) 최저 비용을 나타내는 실행 계획을 선택한다.
![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/2.PNG)

<hr/>

## 1.4 실행계획과 비용
### -실행계획
실행계획(Execution plan)을 사용해 SQL 실행경로를 미리 볼 수 있다. 처리절차가 트리구조로 표현된다. 

![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/3.PNG)

### -비용
비용을 근거로 실행경로를 채택하는데 쿼리 수행하는데 발생할 것으로 예상되는 I/O 횟수 또는 예상 소요 시간을 표현한 값이다.
실측치가 아니므로 실제 수행할 때 발생하는 I/O 또는 시간과 차이가 많이 난다.

<hr/>

## 1.5 옵티마이저 힌트
### -옵티마이저 힌트
아는 정보와 경험과 같이 통계정보에 담을 수 없는 데이터 또는 업무 특성이 존재할 수 있다. 옵티마이저 힌트를 이용해 데이터 액세스 경로를 바꿀 수 있다.

### -힌트 사용법
주석기호에 '+' 붙이기

![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/6.PNG)
![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/7.PNG)
### -주의사항
    -힌트 안에 인자 나열할 때 ','( 콤마)를 사용할 수 있지만, 힌트와 힌트 사이에는 사용하면 안된다.

![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/8.PNG)

    -테이블 지정 시 스키마 명까지 명시하면 안된다.

![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/9.PNG)
    
    -FROM 절 테이블 명 옆에 ALIAS를 지정했다면, 힌트에도 반드시
    ALIAS를 사용해야한다.

![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/10.PNG)

### -자주 사용하는 힌트 목록
![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/4.PNG)
![Alt text](/%EC%B9%9C%EC%A0%88%ED%95%9C%20SQL%20%ED%8A%9C%EB%8B%9D/IMAGE/5.PNG)

<hr/>

##### 출처
Link: [개발자를 위한 SQL 튜닝 입문서 친절한 SQL 튜닝][SQLlink]

[SQLlink]: https://book.naver.com/bookdb/book_detail.nhn?bid=13650217 "book"